const fs = require('fs');
const path = require('path');

module.exports = async function create(args) {
    const projectName = args[0];

    if (!projectName) {
        console.error('‚ùå Nome do projeto √© obrigat√≥rio');
        console.log('Uso: beni create <nome-do-projeto>');
        return;
    }

    console.log(`üöÄ Criando projeto Beni.js: ${projectName}`);

    // Criar diret√≥rio do projeto
    const projectPath = path.join(process.cwd(), projectName);

    if (fs.existsSync(projectPath)) {
        console.error(`‚ùå Pasta '${projectName}' j√° existe`);
        return;
    }

    try {
        fs.mkdirSync(projectPath, { recursive: true });

        // Estrutura do projeto
        const structure = [
            'src',
            'src/templates',
            'src/templates/components',
            'src/styles',
            'public'
        ];

        structure.forEach(dir => {
            fs.mkdirSync(path.join(projectPath, dir), { recursive: true });
        });

        // Criar arquivos do projeto
        createProjectFiles(projectPath, projectName);

        console.log('‚úÖ Projeto criado com sucesso!');
        console.log('');
        console.log('üìã Pr√≥ximos passos:');
        console.log(`   cd ${projectName}`);
        console.log('   npm install');
        console.log('   npm run dev');
        console.log('');
        console.log('üåê Servidor estar√° em: http://localhost:3000');
        console.log('üî• Hot reload ser√° ativado automaticamente');

    } catch (error) {
        console.error('‚ùå Erro ao criar projeto:', error.message);
    }
};

function createProjectFiles(projectPath, projectName) {
    const files = {
        // package.json
        'package.json': JSON.stringify({
            name: projectName,
            version: '1.0.0',
            description: `${projectName} - Aplica√ß√£o Beni.js`,
            scripts: {
                dev: 'beni dev',
                build: 'beni build',
                serve: 'beni serve',
                start: 'npm run dev'
            },
            dependencies: {
                'beni-js': '^1.0.0'
            }
        }, null, 2),

        // ‚úÖ public/index.html - SEM TAILWIND CDN + COM HOT RELOAD
        'public/index.html': `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${projectName}</title>
    <link rel="stylesheet" href="/src/styles/main.css">
    <style>
        /* Estilos b√°sicos para desenvolvimento */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            transition: all 0.15s ease;
        }

        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; transform: translateY(-1px); }

        .btn-green { background: #10b981; color: white; }
        .btn-green:hover { background: #059669; }

        .btn-red { background: #ef4444; color: white; }
        .btn-red:hover { background: #dc2626; }

        .btn-gray { background: #6b7280; color: white; }
        .btn-gray:hover { background: #4b5563; }

        .card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: box-shadow 0.15s ease;
        }

        .card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .text-center { text-align: center; }
        .text-blue { color: #3b82f6; }
        .text-gray { color: #6b7280; }
        .space-x > * + * { margin-left: 0.5rem; }

        h1 { font-size: 2.5rem; font-weight: bold; margin-bottom: 1rem; }
        h2 { font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem; }
        h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; }

        p { margin-bottom: 1rem; }

        .counter-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
            transition: color 0.15s ease;
        }

        /* Hot Reload Indicator */
        .hot-reload-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 9999;
        }

        .hot-reload-indicator.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container { padding: 0 0.5rem; }
            h1 { font-size: 2rem; }
            .grid-2 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Hot Reload Indicator -->
    <div id="hot-reload-indicator" class="hot-reload-indicator">
        üî• Hot Reload Ativo
    </div>

    <div id="app">
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh;">
            <div style="font-size: 1.125rem; color: #6b7280;">Carregando ${projectName}...</div>
        </div>
    </div>

    <!-- Beni.js via UMD -->
    <script src="https://unpkg.com/beni-js@latest/dist/index.umd.js"></script>
    <script src="/src/app.js"></script>
</body>
</html>`,

        // ‚úÖ src/app.js - ROTA 404 CORRIGIDA (SEM '*')
        'src/app.js': `// ${projectName} - Aplica√ß√£o Beni.js
console.log('üî• Iniciando ${projectName}...');

document.addEventListener('DOMContentLoaded', async function() {
    // Criar aplica√ß√£o Beni.js - SEM ANIMA√á√ïES
    const app = Beni.createApp({
        container: '#app',
        hashRouting: true
    });

    // Estado inicial
    app.setState('appName', '${projectName}');
    app.setState('user', { name: 'Desenvolvedor', role: 'Creator' });
    app.setState('counter', 0);
    app.setState('currentPage', 'home');

    // Rota principal
    app.route('/', () => {
        const appName = app.getState('appName');
        const user = app.getState('user');
        const counter = app.getState('counter');

        app.render(\`
            <div class="container" style="padding: 2rem 1rem;">
                <!-- Header -->
                <header class="text-center" style="margin-bottom: 2rem;">
                    <h1 class="text-blue">
                        üî• \${appName}
                    </h1>
                    <p class="text-gray">
                        Criado com Beni.js - Framework SPA minimalista
                    </p>
                </header>

                <!-- Cards Grid -->
                <div class="grid grid-2">
                    <!-- Informa√ß√µes do usu√°rio -->
                    <div class="card">
                        <h2>üë§ Informa√ß√µes do Usu√°rio</h2>
                        <p><strong>Nome:</strong> \${user.name}</p>
                        <p><strong>Fun√ß√£o:</strong> \${user.role}</p>
                    </div>

                    <!-- Contador interativo -->
                    <div class="card">
                        <h2>üî¢ Contador Interativo</h2>
                        <div class="text-center">
                            <div class="counter-display" data-state="counter">\${counter}</div>
                            <div class="space-x">
                                <button onclick="incrementCounter()" class="btn btn-green">
                                    ‚ûï Incrementar
                                </button>
                                <button onclick="decrementCounter()" class="btn btn-red">
                                    ‚ûñ Decrementar
                                </button>
                                <button onclick="resetCounter()" class="btn btn-gray">
                                    üîÑ Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navega√ß√£o -->
                <div class="card">
                    <h2>üß≠ Navega√ß√£o</h2>
                    <div class="space-x">
                        <a href="#/" class="btn btn-primary">üè† Home</a>
                        <a href="#/about" class="btn btn-primary">‚ÑπÔ∏è Sobre</a>
                        <a href="#/features" class="btn btn-primary">‚≠ê Features</a>
                    </div>
                </div>

                <!-- Footer -->
                <footer class="text-center" style="margin-top: 2rem; color: #6b7280; font-size: 0.875rem;">
                    <p>Constru√≠do com ‚ù§Ô∏è usando Beni.js</p>
                </footer>
            </div>
        \`);

        app.setState('currentPage', 'home');
    });

    // Rota Sobre
    app.route('/about', () => {
        const appName = app.getState('appName');

        app.render(\`
            <div class="container" style="padding: 2rem 1rem;">
                <div style="max-width: 800px; margin: 0 auto;">
                    <h1>‚ÑπÔ∏è Sobre o \${appName}</h1>

                    <div class="card">
                        <h2>üìñ Sobre este projeto</h2>
                        <p>
                            O <strong>\${appName}</strong> √© uma aplica√ß√£o Single Page Application (SPA)
                            criada com Beni.js, um framework JavaScript minimalista e perform√°tico.
                        </p>

                        <h3>üöÄ Caracter√≠sticas do Beni.js:</h3>
                        <ul style="list-style: disc; margin-left: 2rem; margin-bottom: 1rem;">
                            <li>‚ö° Perform√°tico e leve (menos de 5KB)</li>
                            <li>üîÑ Sistema de estado reativo</li>
                            <li>üõ£Ô∏è Roteamento com par√¢metros din√¢micos</li>
                            <li>üé® Funciona com qualquer CSS framework</li>
                            <li>üì± Mobile-friendly por padr√£o</li>
                            <li>üõ†Ô∏è CLI completo para desenvolvimento</li>
                            <li>üî• Hot reload integrado</li>
                        </ul>
                    </div>

                    <div class="text-center">
                        <a href="#/" class="btn btn-primary">‚Üê Voltar para Home</a>
                    </div>
                </div>
            </div>
        \`);

        app.setState('currentPage', 'about');
    });

    // Rota Features
    app.route('/features', () => {
        app.render(\`
            <div class="container" style="padding: 2rem 1rem;">
                <div style="max-width: 1000px; margin: 0 auto;">
                    <h1>‚≠ê Features do Beni.js</h1>

                    <div class="grid grid-2">
                        <div class="card">
                            <h3 class="text-blue">üöÄ Performance</h3>
                            <p>
                                Renderiza√ß√£o otimizada sem anima√ß√µes desnecess√°rias.
                                Bundle pequeno para carregamento instant√¢neo.
                            </p>
                        </div>

                        <div class="card">
                            <h3 style="color: #10b981;">üîÑ Estado Reativo</h3>
                            <p>
                                Sistema de estado reativo que atualiza automaticamente a UI
                                quando os dados mudam.
                            </p>
                        </div>

                        <div class="card">
                            <h3 style="color: #8b5cf6;">üõ£Ô∏è Roteamento</h3>
                            <p>
                                Roteamento simples com suporte a par√¢metros din√¢micos
                                e navega√ß√£o program√°tica.
                            </p>
                        </div>

                        <div class="card">
                            <h3 style="color: #f97316;">üî• Hot Reload</h3>
                            <p>
                                Desenvolvimento com hot reload autom√°tico.
                                Edite arquivos e veja mudan√ßas instantaneamente.
                            </p>
                        </div>
                    </div>

                    <div class="text-center">
                        <a href="#/" class="btn btn-primary">‚Üê Voltar para Home</a>
                    </div>
                </div>
            </div>
        \`);

        app.setState('currentPage', 'features');
    });

    // ‚úÖ ROTA 404 CORRIGIDA (usar '404' em vez de '*')
    app.route('404', () => {
        app.render(\`
            <div class="container" style="padding: 2rem 1rem;">
                <div class="text-center" style="padding: 4rem 0;">
                    <h1 style="color: #ef4444; font-size: 4rem; margin-bottom: 1rem;">404</h1>
                    <h2 style="margin-bottom: 2rem;">P√°gina n√£o encontrada</h2>
                    <p class="text-gray" style="margin-bottom: 2rem;">
                        A p√°gina que voc√™ est√° procurando n√£o existe.
                    </p>
                    <a href="#/" class="btn btn-primary">
                        üè† Voltar para Home
                    </a>
                </div>
            </div>
        \`);
    });

    // Fun√ß√µes globais para os bot√µes
    window.incrementCounter = function() {
        const current = app.getState('counter');
        app.setState('counter', current + 1);

        // Mostrar hot reload indicator brevemente
        showHotReloadIndicator();
    };

    window.decrementCounter = function() {
        const current = app.getState('counter');
        app.setState('counter', current - 1);

        showHotReloadIndicator();
    };

    window.resetCounter = function() {
        app.setState('counter', 0);

        showHotReloadIndicator();
    };

    // Fun√ß√£o para mostrar indicador de hot reload
    function showHotReloadIndicator() {
        const indicator = document.getElementById('hot-reload-indicator');
        if (indicator) {
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }
    }

    // Subscri√ß√µes de estado
    app.subscribe('counter', (value) => {
        console.log('üìä Counter mudou para:', value);
    });

    app.subscribe('currentPage', (page) => {
        console.log('üìÑ P√°gina atual:', page);
        document.title = \`\${app.getState('appName')} - \${page}\`;
    });

    // Inicializar aplica√ß√£o
    await app.init();

    console.log('‚úÖ ${projectName} inicializado com sucesso!');
    console.log('üî• Hot reload ativo - edite arquivos para ver mudan√ßas');
});`,

        // ‚úÖ src/styles/main.css - SEM ANIMA√á√ïES AGRESSIVAS
        'src/styles/main.css': `/* ${projectName} - Estilos personalizados */

/* Import de fontes */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

/* Vari√°veis CSS */
:root {
    --primary-color: #3b82f6;
    --secondary-color: #10b981;
    --danger-color: #ef4444;
    --warning-color: #f59e0b;
    --dark-color: #1f2937;
    --light-color: #f9fafb;
    --border-radius: 0.5rem;
    --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    --transition: all 0.15s ease;
}

/* Reset b√°sico */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    line-height: 1.6;
    color: var(--dark-color);
    background-color: var(--light-color);
}

/* Layout responsivo */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
}

/* Componentes */
.card {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    transition: var(--transition);
}

.card:hover {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* Sistema de grid */
.grid {
    display: grid;
    gap: 1.5rem;
}

.grid-2 {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

/* Bot√µes */
.btn {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    border-radius: var(--border-radius);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.875rem;
    transition: var(--transition);
    cursor: pointer;
    border: none;
    text-align: center;
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: #2563eb;
}

/* Utilit√°rios */
.text-center { text-align: center; }
.space-x > * + * { margin-left: 0.5rem; }

/* Typography */
h1, h2, h3, h4, h5, h6 {
    font-weight: 600;
    line-height: 1.2;
    margin-bottom: 1rem;
}

h1 { font-size: 2.5rem; }
h2 { font-size: 1.875rem; }
h3 { font-size: 1.5rem; }

p {
    margin-bottom: 1rem;
}

/* Responsividade */
@media (max-width: 768px) {
    .container {
        padding: 0 0.5rem;
    }

    h1 { font-size: 2rem; }
    h2 { font-size: 1.5rem; }

    .grid-2 {
        grid-template-columns: 1fr;
    }

    .btn {
        display: block;
        width: 100%;
        margin-bottom: 0.5rem;
    }

    .space-x > * {
        margin-left: 0;
        margin-bottom: 0.5rem;
    }
}

/* Hot reload indicator animation */
@keyframes hotReloadPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

.hot-reload-indicator.show {
    animation: hotReloadPulse 0.5s ease-in-out;
}`,

        // ‚úÖ README.md ATUALIZADO
        'README.md': `# ${projectName}

Aplica√ß√£o criada com [Beni.js](https://www.npmjs.com/package/beni-js) - Framework SPA minimalista e perform√°tico.

## üöÄ Como executar

\`\`\`bash
# Instalar depend√™ncias
npm install

# Desenvolvimento com hot reload
npm run dev
# Acesse: http://localhost:3000

# Build para produ√ß√£o
npm run build

# Servir produ√ß√£o
npm run serve
# Acesse: http://localhost:8080
\`\`\`

## üìÅ Estrutura do projeto

\`\`\`
${projectName}/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app.js              # Aplica√ß√£o principal
‚îÇ   ‚îî‚îÄ‚îÄ styles/
‚îÇ       ‚îî‚îÄ‚îÄ main.css        # Estilos personalizados
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ index.html          # HTML base
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
\`\`\`

## ‚úÖ Corre√ß√µes implementadas

- üîß **Rota 404**: Corrigida para usar '404' em vez de '*'
- üé® **CSS**: Removido Tailwind CDN, adicionado CSS personalizado
- üî• **Hot Reload**: Ativo automaticamente durante desenvolvimento
- ‚ö° **Performance**: Sem anima√ß√µes desnecess√°rias
- üì± **Responsivo**: Layout adapt√°vel para mobile

## üî• Features

- ‚ö° **Perform√°tico**: Renderiza√ß√£o instant√¢nea sem piscar
- üîÑ **Reativo**: Estado reativo que atualiza a UI automaticamente
- üõ£Ô∏è **Roteamento**: Navega√ß√£o SPA com hash routing
- üì± **Responsivo**: Mobile-first design
- üé® **CSS Personalizado**: Estilos pr√≥prios sem depend√™ncias externas
- üî• **Hot Reload**: Mudan√ßas instant√¢neas durante desenvolvimento

## üß™ Desenvolvimento

Durante o desenvolvimento:

1. **Hot Reload**: Edite qualquer arquivo e veja mudan√ßas instant√¢neas
2. **File Watcher**: Observa arquivos em \`src/\`, \`public/\` e arquivos raiz
3. **WebSocket**: Conex√£o em tempo real para recarregamento autom√°tico
4. **Logs**: Acompanhe mudan√ßas no terminal

## üìö Sobre Beni.js

Beni.js √© um framework JavaScript minimalista para criar SPAs com:

- Bundle pequeno (< 5KB)
- API simples e intuitiva
- Sistema de estado reativo
- Roteamento com par√¢metros
- CLI completo para desenvolvimento
- Hot reload integrado

## üìÑ Licen√ßa

MIT
`,

        // .gitignore
        '.gitignore': `# Dependencies
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Production build
dist/
build/

# Environment variables
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# OS generated files
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# IDE
.vscode/
.idea/
*.swp
*.swo

# Logs
logs
*.log

# Cache
.cache/
.parcel-cache/

# Hot reload files
*.hot-update.*`
    };

    // Criar todos os arquivos
    Object.entries(files).forEach(([relativePath, content]) => {
        const fullPath = path.join(projectPath, relativePath);
        const dir = path.dirname(fullPath);

        // Criar diret√≥rio se n√£o existir
        if (!fs.existsSync(dir)) {
            fs.mkdirSync(dir, { recursive: true });
        }

        // Escrever arquivo
        fs.writeFileSync(fullPath, content, 'utf8');
    });
}